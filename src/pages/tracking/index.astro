---
import BaseHead from '../../components/BaseHead.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import { getCollection } from 'astro:content';
import { isClockString } from '../../utils/time';

const runs = (await getCollection('tracking')).filter(t => t.data.type==='run').slice(0,6);
const workouts = (await getCollection('tracking')).filter(t => t.data.type==='workout').slice(0,6);
---
<html lang="en">
  <head>
    <BaseHead title="Tracking" description="Quick links to runs, workouts, and more." />
  </head>
  <body>
    <Header />
    <main>
      <h1>Tracking</h1>
      <div class="grid md:grid-cols-2 gap-4 mt-4">
        <section class="surface p-4 rounded-xl">
          <div class="flex items-center justify-between">
            <h2>Runs</h2>
            <a href="/tracking/run/" class="text-sm">See all →</a>
          </div>
          <ul class="mt-2 space-y-2">
            {runs.map(r => (
              <li><a href={`/tracking/${r.id}/`} class="block card-hover">{new Date(r.data.date).toLocaleDateString()} — {r.data.distanceKm ?? 0} km</a></li>
            ))}
          </ul>
        </section>
        <section class="surface p-4 rounded-xl">
          <div class="flex items-center justify-between">
            <h2>Workouts</h2>
            <a href="/tracking/workout" class="text-sm">See all →</a>
          </div>
          <ul class="mt-2 space-y-2">
            {workouts.map(w => (
              <li><a href={`/tracking/${w.id}/`} class="block card-hover">{new Date(w.data.date).toLocaleDateString()} — {w.data.durationMin ? (isClockString(w.data.durationMin) ? w.data.durationMin : `${w.data.durationMin} min`) : '—'}</a></li>
            ))}
          </ul>
        </section>
      </div>
      <div class="mt-6">
        <a class="inline-block px-3 py-2 rounded-md border border-[var(--border)]" href="/tracking/stats">Aggregated stats</a>
      </div>
    </main>
    <Footer />
  </body>
</html>
